<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Snake Game</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      background-color: #F7F7F7;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .game-container {
      background-color: #FFFFFF;
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 0 1rem rgba(0, 0, 0, .1);
      text-align: center;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    canvas {
      display: block;
      margin: 0 auto;
      border: 1px solid #000;
    }

    .buttons {
      margin-top: 1rem;
    }

    .buttons button {
      background-color: #4CAF50;
      border: none;
      color: white;
      padding: 0.5rem 1rem;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 1rem;
      margin: 0 0.5rem;
      cursor: pointer;
      border-radius: 0.5rem;
    }

    .buttons button:hover {
      background-color: #45a049;
    }

    .score {
      font-size: 1.2rem;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
<div class="game-container">
  <h1>스네이크 게임</h1>
  <canvas id="game-board" width="400" height="400"></canvas>
  <div class="buttons">
    <button id="start-btn">시작</button>
    <button id="stop-btn">정지</button>
    <button class="explanation-btn" onclick="window.location.href='explan.html'">설명 보기</button>
  </div>
  <p class="score">점수: <span id="score">0</span></p>
</div>

<script>
  const canvas = document.getElementById("game-board");
  const ctx = canvas.getContext("2d");

  const SCALE = 20;
  const ROWS = canvas.height / SCALE;
  const COLUMNS = canvas.width / SCALE;

  let score = 0;
  let snake, fruit, gameRunning = false;
  let lastRenderTime = 0;

  // 뱀 객체 정의
  class Snake {
    constructor() {
      this.x = 0;
      this.y = 0;
      this.xSpeed = SCALE;
      this.ySpeed = 0;
      this.tail = [];
      this.newDirection = null;
    }

    // 뱀 그리기 함수
    draw() {
      ctx.fillStyle = "#4CAF50";
      for (const part of this.tail) {
        ctx.fillRect(part.x, part.y, SCALE, SCALE);
      }
      ctx.fillRect(this.x, this.y, SCALE, SCALE);
    }

    // 뱀의 위치 업데이트 함수
    update() {
      if (this.newDirection) {
        this.changeDirection(this.newDirection);
        this.newDirection = null;
      }

      this.tail.push({x: this.x, y: this.y});
      this.tail.shift();

      this.x += this.xSpeed;
      this.y += this.ySpeed;

      if (this.x < 0 || this.y < 0 || this.x >= canvas.width || this.y >= canvas.height) {
        gameOver();
      }
    }

    // 방향 변경 함수
    changeDirection(direction) {
      const opposite = {
        Up: "Down",
        Down: "Up",
        Left: "Right",
        Right: "Left"
      };

      if (direction === opposite[this.currentDirection()]) {
        return;
      }

      switch (direction) {
        case "Up":
          this.xSpeed = 0;
          this.ySpeed = -SCALE;
          break;
        case "Down":
          this.xSpeed = 0;
          this.ySpeed = SCALE;
          break;
        case "Left":
          this.xSpeed = -SCALE;
          this.ySpeed = 0;
          break;
        case "Right":
          this.xSpeed = SCALE;
          this.ySpeed = 0;
          break;
      }
    }

    currentDirection() {
      if (this.xSpeed === SCALE) {
        return "Right";
      }
      if (this.xSpeed === -SCALE) {
        return "Left";
      }
      if (this.ySpeed === SCALE) {
        return "Down";
      }
      if (this.ySpeed === -SCALE) {
        return "Up";
      }
    }

    eat(fruit) {
      if (this.x === fruit.x && this.y === fruit.y) {
        this.tail.push({x: this.x - this.xSpeed, y: this.y - this.ySpeed});
        return true;
      }
      return false;
    }

    checkCollision() {
      for (const part of this.tail) {
        if (this.x === part.x && this.y === part.y) {
          gameOver();
        }
      }
    }

    reset() {
      this.x = 0;
      this.y = 0;
      this.xSpeed = SCALE;
      this.ySpeed = 0;
      this.tail = [];
      score = 0;
      document.getElementById("score").textContent = score;
    }
  }

  // 먹이 객체 정의
  class Fruit {
    constructor() {
      this.x = 0;
      this.y = 0;
      this.pickLocation();
    }

    pickLocation() {
      this.x = Math.floor(Math.random() * COLUMNS) * SCALE;
      this.y = Math.floor(Math.random() * ROWS) * SCALE;
    }

    draw() {
      ctx.fillStyle = "#FF4136";
      ctx.fillRect(this.x, this.y, SCALE, SCALE);
    }
  }

  function drawBorder() {
    ctx.strokeStyle = "red";
    ctx.lineWidth = 5;
    ctx.strokeRect(0, 0, canvas.width, canvas.height);
  }

  // 게임 시작 함수
  function startGame() {
    if (gameRunning) {
      return;
    }
    snake = new Snake();
    fruit = new Fruit();
    gameRunning = true;
    window.requestAnimationFrame(gameLoop);
  }

  // 게임 루프 함수 (requestAnimationFrame 사용)
  function gameLoop(currentTime) {
    if (!gameRunning) {
      return;
    }

    if (currentTime - lastRenderTime >= 250) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawBorder();
      fruit.draw();
      snake.update();
      snake.draw();

      if (snake.eat(fruit)) {
        score++;
        document.getElementById("score").textContent = score;
        fruit.pickLocation();
      }

      snake.checkCollision();
      lastRenderTime = currentTime;
    }

    window.requestAnimationFrame(gameLoop);
  }

  // 게임 정지 함수
  function stopGame() {
    gameRunning = false;
  }

  function gameOver() {
    alert("게임 오버! 점수: " + score);
    snake.reset();
    stopGame();
  }

  // 방향키 입력 이벤트 처리
  window.addEventListener("keydown", (event) => {
    const direction = event.key.replace("Arrow", "");
    snake.newDirection = direction;
  });

  document.getElementById("start-btn").addEventListener("click", startGame);
  document.getElementById("stop-btn").addEventListener("click", stopGame);
</script>
</body>
</html>
